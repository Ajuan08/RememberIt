"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3879],{3879:(D,h,n)=>{n.r(h),n.d(h,{CitaPageModule:()=>P});var f=n(177),u=n(4341),o=n(1075),m=n(8621),g=n(467),C=n(963),e=n(4438),p=n(4796),M=n(4035);function v(a,s){if(1&a&&(e.j41(0,"ion-select-option",5),e.EFF(1),e.j41(2,"span",6),e.EFF(3),e.k0s()()),2&a){const l=s.$implicit;e.Y8G("value",l),e.R7$(),e.SpI(" ",l.nombre," "),e.R7$(2),e.SpI("(",l.especialidad,")")}}const y=[{path:"",component:(()=>{var a;class s{constructor(t,i,c,r){this.authService=t,this.firestoreService=i,this.router=c,this.alertController=r,this.email="",this.medicos=[],this.fechaHora="",this.today=(new Date).toISOString().split("T")[0]+"T"+(new Date).toISOString().split("T")[1].slice(0,5)}ngOnInit(){this.email=this.authService.getCurrentUserEmail(),this.fechaHora=this.today,this.loadMedicos()}loadMedicos(){this.firestoreService.getCollection("medicos").subscribe(t=>{this.medicos=t.map(i=>({id:i.payload.doc.id,...i.payload.doc.data()}))})}addCita(){var t=this;return(0,g.A)(function*(){if(t.email&&t.selectedMedico&&t.fechaHora){const i={email:t.email,medico:t.selectedMedico,fechaHora:t.fechaHora};!function(){var r=(0,g.A)(function*(){try{yield t.firestoreService.createDoc("citas",i),console.log("Cita a\xf1adida"),t.presentConfirmationAlert();const d=new Date(t.fechaHora),H=new Date(d.getTime()-72e5);yield C.W.schedule({notifications:[{title:"Cita Pr\xf3xima",body:"Tu cita es en menos de 2 horas con el Dr. "+t.selectedMedico.nombre,id:1,schedule:{at:H},sound:"../../android/app/src/main/res/raw/beep.wav",attachments:void 0,actionTypeId:"",extra:null}]})}catch(d){console.error("Error al a\xf1adir la cita:",d)}});return function(){return r.apply(this,arguments)}}()()}else console.error("Todos los campos son requeridos")})()}presentConfirmationAlert(){var t=this;return(0,g.A)(function*(){yield(yield t.alertController.create({header:"Confirmaci\xf3n",message:"La cita ha sido a\xf1adida correctamente.",buttons:[{text:"Aceptar",handler:()=>{t.router.navigateByUrl("/tabs/listado")}}]})).present()})()}}return(a=s).\u0275fac=function(t){return new(t||a)(e.rXU(p.u),e.rXU(M.B),e.rXU(m.Ix),e.rXU(o.hG))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-cita"]],decls:19,vars:5,consts:[["position","floating"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["display-format","MM/DD/YYYY HH:mm","picker-format","MM/DD/YYYY HH:mm",3,"ngModelChange","min","ngModel","value"],["expand","full",3,"click"],[3,"value"],[1,"especialidad"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"A\xf1adir Cita"),e.k0s()()(),e.j41(4,"ion-content")(5,"ion-grid")(6,"ion-row")(7,"ion-col")(8,"ion-item")(9,"ion-label",0),e.EFF(10,"M\xe9dico"),e.k0s(),e.j41(11,"ion-select",1),e.mxI("ngModelChange",function(r){return e.DH7(i.selectedMedico,r)||(i.selectedMedico=r),r}),e.DNE(12,v,4,3,"ion-select-option",2),e.k0s()(),e.j41(13,"ion-item")(14,"ion-label",0),e.EFF(15,"Fecha y Hora"),e.k0s(),e.j41(16,"ion-datetime",3),e.mxI("ngModelChange",function(r){return e.DH7(i.fechaHora,r)||(i.fechaHora=r),r}),e.k0s()(),e.j41(17,"ion-button",4),e.bIt("click",function(){return i.addCita()}),e.EFF(18,"A\xf1adir al Calendario"),e.k0s()()()()()),2&t&&(e.R7$(11),e.R50("ngModel",i.selectedMedico),e.R7$(),e.Y8G("ngForOf",i.medicos),e.R7$(4),e.FS9("min",i.today),e.FS9("value",i.today),e.R50("ngModel",i.fechaHora))},dependencies:[f.Sq,u.BC,u.vS,o.Jm,o.hU,o.W9,o.A9,o.lO,o.eU,o.uz,o.he,o.ln,o.Nm,o.Ip,o.BC,o.ai,o.Je],styles:[".especialidad[_ngcontent-%COMP%]{color:gray;font-size:.9em}"]}),s})()}];let F=(()=>{var a;class s{}return(a=s).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[m.iI.forChild(y),m.iI]}),s})(),P=(()=>{var a;class s{}return(a=s).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[f.MD,u.YN,o.bv,F]}),s})()}}]);